const puppeteer = require('puppeteer');
const file = require('fs')

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

(async () => {
  const browser = await puppeteer.launch({headless: true});
  const page = await browser.newPage();

  let imagesSaved = file.readFileSync(`${__dirname}/images.json`)
  imagesSaved = JSON.parse(imagesSaved)
  imagesSaved = imagesSaved.reduce((prev, curr) => {
    prev[curr.park] = curr
    return prev
  }, {})

  const parks = [
    'Lowell National Historical Park',
    'Mississippi National River and Recreation Area',
    'Nez Perce National Historical Park',
    'New River Gorge National River',
    'Obed Wild and Scenic River',
    'Poverty Point National Monument',
    'Redwood National Park',
    'Rio Grande Wild and Scenic River',
    'San Juan National Historic Site',
    'Shenandoah National Park',
    'Shiloh National Battlefield',
    'Sleeping Bear Dunes National Lakeshore',
    'Steamtown National Historic Site',
    'Stones River National Battlefield',
    'Timucuan Ecological and Historic Preserve',
    'Vicksburg National Military Park',
    'Cedar Creek and Belle Grove National Historical Park',
    'Little Bighorn Battlefield National Monument',
    'Capulin Volcano National Monument',
    'Fort Bowie National Historic Site',
    'Gila Cliff Dwellings National Monument',
    'Manassas National Battlefield Park',
    'Tumacacori National Historical Park',
    'Tuzigoot National Monument',
    'Yucca House National Monument',
    'Wolf Trap National Park for the Performing Arts',
    'Monocacy National Battlefield',
    'Antietam National Battlefield',
    'Castillo de San Marcos National Monument',
    'Timpanogos Cave National Monument',
    'Theodore Roosevelt Island National Memorial',
    'Lyndon Baines Johnson Memorial Grove on the Potomac',
    'Arlington House, The Robert E. Lee Memorial',
    'Cumberland Gap National Historical Park',
    'Wupatki National Monument',
    'Greenbelt Park',
    'Tupelo National Battlefield',
    'Brices Cross Roads National Battlefield Site',
    'Point Reyes National Seashore',
    'Fort Sumter National Monument',
    'Florissant Fossil Beds National Monument',
    'Tonto National Monument',
    'Home of Franklin D. Roosevelt National Historic Site',
    'Ninety Six National Historic Site',
    'Charles Pinckney National Historic Site',
    'Buck Island Reef National Monument',
    'Carter G. Woodson National Historic Site',
    'Cedar Breaks National Monument',
    'Padre Island National Seashore',
    'Arches National Park',
    'Boston Harbor Islands National Recreation Area',
    'Sunset Crater Volcano National Monument',
    'Mary McLeod Bethune Council House National Historic Site',
    'Ford\'s Theatre National Historic Site',
    'Brown v. Board of Education National Historic Site',
    'Pipe Spring National Monument',
    'El Morro National Monument',
    'Chickasaw National Recreation Area',
    'Andrew Johnson National Historic Site',
    'Saint Paul\'s Church National Historic Site',
    'Castle Clinton National Monument',
    'Fossil Butte National Monument',
    'Effigy Mounds National Monument',
    'Ice Age National Scenic Trail',
    'Hovenweep National Monument',
    'Fort Union National Monument',
    'Abraham Lincoln Birthplace National Historical Park',
    'Dry Tortugas National Park',
    'Fort Frederica National Monument',
    'Piscataway Park',
    'Manzanar National Historic Site',
    'Bryce Canyon National Park',
    'John D. Rockefeller, Jr., Memorial Parkway',
    'George Washington Carver National Monument',
    'Thomas Edison National Historical Park',
    'Yellowstone National Park',
    'Hubbell Trading Post National Historic Site',
    'Chamizal National Memorial',
    'Hawai\'i Volcanoes National Park',
    'Alibates Flint Quarries National Monument',
    'Pu\'ukohola Heiau National Historic Site',
    'Ulysses S. Grant National Historic Site',
    'Canaveral National Seashore',
    'African Burial Ground National Monument',
    'Cabrillo National Monument',
    'Valley Forge National Historical Park',
    'George Washington Memorial Parkway',
    'Clara Barton National Historic Site',
    'Fort Washington Park',
    'Sequoia National Park',
    'Kalaupapa National Historical Park',
    'Tuskegee Airmen National Historic Site',
    'Salt River Bay National Historical Park and Ecological Preserve',
    'Natchez National Historical Park',
    'Edgar Allan Poe National Historic Site',
    'Boston African American National Historic Site',
    'Mammoth Cave National Park',
    'Grand Teton National Park',
    'Eugene O\'Neill National Historic Site',
    'Adams National Historical Park',
    'Navajo National Monument',
    'Thomas Stone National Historic Site',
    'Cane River Creole National Historical Park',
    'Mesa Verde National Park',
    'Great Basin National Park',
    'Grand Portage National Monument',
    'Whiskeytown-Shasta-Trinity National Recreation Area',
    'Fort Point National Historic Site',
    'Salem Maritime National Historic Site',
    'Washington Monument',
    'Thomas Jefferson Memorial',
    'Moores Creek National Battlefield',
    'Horseshoe Bend National Military Park',
    'Fort Matanzas National Monument',
    'Channel Islands National Park',
    'Canyonlands National Park',
    'Little Rock Central High School National Historic Site',
    'White House',
    'Booker T. Washington National Monument',
    'Jean Lafitte National Historical Park and Preserve',
    'Jewel Cave National Monument',
    'Fort Larned National Historic Site',
    'Kaloko-Honokohau National Historical Park',
    'Rosie the Riveter/World War II Home Front National Historical Park',
    'Fort Stanwix National Monument',
    'Thaddeus Kosciuszko National Memorial',
    'William Howard Taft National Historic Site',
    'Fort Scott National Historic Site',
    'Perry\'s Victory and International Peace Memorial',
    'James A. Garfield National Historic Site',
    'Catoctin Mountain Park',
    'Rainbow Bridge National Monument',
    'Natural Bridges National Monument',
    'Bent\'s Old Fort National Historic Site',
    'Hohokam Pima National Monument',
    'Gulf Islands National Seashore',
    'Walnut Canyon National Monument',
    'Appomattox Court House National Historical Park',
    'Pipestone National Monument',
    'World War II Valor in the Pacific National Monument',
    'Biscayne National Park',
    'Minute Man National Historical Park',
    'Arkansas Post National Memorial',
    'Mount Rushmore National Memorial',
    'Guadalupe Mountains National Park',
    'City of Rocks National Reserve',
    'Hagerman Fossil Beds National Monument',
    'John Muir National Historic Site',
    'Petersburg National Battlefield',
    'President William Jefferson Clinton Birthplace Home National Historic Site',
    'Fort Vancouver National Historic Site',
    'Saint-Gaudens National Historic Site',
    'John Fitzgerald Kennedy National Historic Site',
    'Jefferson National Expansion Memorial',
    'Fort Pulaski National Monument',
    'Eleanor Roosevelt National Historic Site',
    'Friendship Hill National Historic Site',
    'Theodore Roosevelt Birthplace National Historic Site',
    'Coronado National Memorial',
    'Wright Brothers National Memorial',
    'Selma to Montgomery National Historic Trail',
    'Kings Mountain National Military Park',
    'Golden Spike National Historic Site',
    'New Bedford Whaling National Historical Park',
    'Sagamore Hill National Historic Site',
    'Lava Beds National Monument',
    'Women\'s Rights National Historical Park',
    'George Rogers Clark National Historical Park',
    'Longfellow House-Washington\'s Headquarters National Historic Site',
    'Hopewell Furnace National Historic Site',
    'Franklin Delano Roosevelt Memorial',
    'Montezuma Castle National Monument',
    'Kings Canyon National Park',
    'Springfield Armory National Historic Site',
    'Whitman Mission National Historic Site',
    'World War II Memorial',
    'Vietnam Veterans Memorial',
    'Korean War Veterans Memorial',
    'Constitution Gardens',
    'Martin Luther King, Jr., Memorial',
    'Lincoln Memorial',
    'National Mall',
    'Russell Cave National Monument',
    'Maggie L. Walker National Historic Site',
    'Fort Davis National Historic Site',
    'Bighorn Canyon National Recreation Area',
    'Pu\'uhonua o Honaunau National Historical Park',
    'Nicodemus National Historic Site',
    'Muir Woods National Monument',
    'Harry S Truman National Historic Site',
    'Sand Creek Massacre National Historic Site',
    'Knife River Indian Villages National Historic Site',
    'Morristown National Historical Park',
    'Herbert Hoover National Historic Site',
    'Martin Van Buren National Historic Site',
    'Governors Island National Monument',
    'Scotts Bluff National Monument',
    'Johnstown Flood National Memorial',
    'Washita Battlefield National Historic Site',
    'Agate Fossil Beds National Monument',
    'Ronald Reagan Boyhood Home National Historic Site',
    'Capitol Reef National Park',
    'Flight 93 National Memorial',
    'Devils Postpile National Monument',
    'San Francisco Maritime National Historical Park',
    'Palo Alto Battlefield National Historical Park',
    'Joshua Tree National Park',
    'Virgin Islands Coral Reef National Monument',
    'Marsh-Billings-Rockefeller National Historical Park',
    'Little River Canyon National Preserve',
    'Charles Young Buffalo Soldiers National Monument',
    'Dayton Aviation Heritage National Historical Park',
    'Eisenhower National Historic Site',
    'First Ladies National Historic Site',
    'Petroglyph National Monument',
    'Cesar E. Chavez National Monument',
    'Fort Necessity National Battlefield',
    'Minuteman Missile National Historic Site',
    'Salinas Pueblo Missions National Monument',
    'Pinnacles National Park',
    'Virgin Islands National Park',
    'Rocky Mountain National Park',
    'Death Valley National Park',
    'Fort McHenry National Monument and Historic Shrine',
    'Niobrara National Scenic River',
    'Grand Canyon National Park',
    'Lake Mead National Recreation Area',
    'Saugus Iron Works National Historic Site',
    'Roger Williams National Memorial',
    'Casa Grande Ruins National Monument',
    'Kennesaw Mountain National Battlefield Park',
    'Christiansted National Historic Site',
    'Allegheny Portage Railroad National Historic Site',
    'De Soto National Memorial',
    'Andersonville National Historic Site',
    'Ocmulgee National Monument',
    'Cowpens National Battlefield',
    'Chiricahua National Monument',
    'Martin Luther King, Jr., National Historic Site',
    'Gettysburg National Military Park',
    'War in the Pacific',
    'Devils Tower National Monument',
    'Boston National Historical Park',
    'Oregon Caves National Monument and Preserve',
    'General Grant National Memorial',
    'River Raisin National Battlefield Park',
    'Golden Gate National Recreation Area',
    'Port Chicago Naval Magazine National Memorial',
    'National Capital Parks',
    'John Day Fossil Beds National Monument',
    'First State National Historical Park',
    'Guilford Courthouse National Military Park',
    'Paterson Great Falls National Historical Park',
    'Pea Ridge National Military Park',
    'Weir Farm National Historic Site',
    'Theodore Roosevelt Inaugural National Historic Site',
    'Lassen Volcanic National Park',
    'Badlands National Park',
    'Honouliuli National Monument',
    'Fort Donelson National Battlefield',
    'Vanderbilt Mansion National Historic Site',
    'Jimmy Carter National Historic Site',
    'San Juan Island National Historical Park',
    'Gateway National Recreation Area',
    'Upper Delaware Scenic and Recreational River',
    'Fort Union Trading Post National Historic Site',
    'Minidoka National Historic Site',
    'Big Hole National Battlefield',
    'Canyon de Chelly National Monument',
    'Cape Cod National Seashore',
    'Saratoga National Historical Park',
    'Manhattan Project National Historical Park',
    'Mount Rainier National Park',
    'Lincoln Boyhood National Memorial',
    'Frederick Law Olmsted National Historic Site',
    'Castle Mountains National Monument',
    'George Washington Birthplace National Monument',
    'Hamilton Grange National Memorial',
    'Hampton National Historic Site',
    'Waco Mammoth National Monument',
    'Glen Canyon National Recreation Area',
    'Yosemite National Park',
    'Tallgrass Prairie National Preserve',
    'Tuskegee Institute National Historic Site',
    'Fort Caroline National Memorial',
    'Saint Croix Island International Historic Site',
    'Fort Laramie National Historic Site',
    'Lower Saint Croix National Scenic Riverway',
    'Prince William Forest Park',
    'Statue Of Liberty National Monument',
    'Bandelier National Monument',
    'Valles Caldera National Preserve',
    'Wind Cave National Park',
    'Natchez Trace Parkway',
    'Colorado National Monument',
    'Fredericksburg and Spotsylvania County Battlefields Memorial National Military Park',
    'Colonial National Historical Park',
    'Alagnak Wild River',
    'Aniakchak National Monument',
    'Aniakchak National Preserve',
    'Bering Land Bridge National Preserve',
    'Cape Krusenstern National Monument',
    'Denali National Park',
    'Denali National Preserve',
    'Gates of the Arctic National Park',
    'Gates of the Arctic National Preserve',
    'Glacier Bay National Park',
    'Glacier Bay National Preserve',
    'Katmai National Park',
    'Katmai National Preserve',
    'Kenai Fjords National Park',
    'Klondike Gold Rush National Historical Park',
    'Kobuk Valley National Park',
    'Lake Clark National Park',
    'Lake Clark National Preserve',
    'Noatak National Preserve',
    'Sitka National Historical Park',
    'Wrangell-St. Elias National Park',
    'Wrangell-St. Elias National Preserve',
    'Yukon-Charley Rivers National Preserve',
    'Richmond National Battlefield Park',
    'Pullman National Monument',
    'Pennsylvania Avenue National Historic Site',
    'World War I Memorial',
    'Belmont-Paul Women\'s Equality National Monument',
    'North Cascades National Park',
    'Ross Lake National Recreation Area',
    'Stonewall National Monument',
    'Fort Monroe National Monument',
    'National Park of American Samoa',
    'Voyageurs National Park',
    'Harpers Ferry National Historical Park',
    'Buffalo National River',
    'Congaree National Park',
    'Homestead National Monument',
    'Federal Hall National Memorial',
    'Hot Springs National Park',
    'Frederick Douglass National Historic Site',
    'Fort Smith National Historic Site',
    'Hopewell Culture National Historical Park',
    'Ozark National Scenic Riverway',
    'Haleakala National Park',
    'El Malpais National Monument',
    'Big Bend National Park',
    'Lewis and Clark National Historic Trail',
    'Lake Chelan National Recreation Area',
    'Delaware Water Gap National Recreation Area',
    'Carl Sandburg Home National Historic Site',
    'Harriet Tubman Underground Railroad National Historical Park',
    'Saint Croix National Scenic Riverway',
    'Lyndon B. Johnson National Historical Park',
    'Carlsbad Caverns National Park',
    'Chaco Culture National Historical Park',
    'Aztec Ruins National Monument',
    'Zion National Park',
    'Great Sand Dunes National Preserve',
    'Great Sand Dunes National Park',
    'Lincoln Home National Historic Site',
    'San Antonio Missions National Historical Park',
    'Grant-Kohrs Ranch National Historic Site',
    'Katahdin Woods And Waters National Monument',
    'Craters of the Moon National Preserve',
    'Craters of the Moon National Monument',
    'White Sands National Monument',
    'Pecos National Historical Park',
    'Organ Pipe Cactus National Monument',
    'Curecanti National Recreation Area',
    'Black Canyon of the Gunnison National Park',
    'Missouri National Recreation River',
    'Petrified Forest National Park',
    'Theodore Roosevelt National Park',
    'Cuyahoga Valley National Park',
    'Dinosaur National Monument',
    'Crater Lake National Park',
    'Rock Creek Park',
    'Pictured Rocks National Lakeshore',
    'Big Thicket National Preserve',
    'Indiana Dunes National Lakeshore',
    'Apostle Islands National Lakeshore',
    'Wilson\'s Creek National Battlefield',
    'Glacier National Park',
    'Saguaro National Park',
    'Mojave National Preserve',
    'Keweenaw National Historical Park',
  ]

  const images = []

  for (let i = 0; i < parks.length; i += 1) {
    if (imagesSaved[parks[i]]) {
      images.push(imagesSaved[parks[i]])
      continue
    }

    try {
      await page.goto('https://www.nps.gov/search/?utf8=%25E2%259C%2593&affiliate=nps&sort_by=&query=&commit=Search');
      await page.type('input[id=query]', parks[i], {delay: 20})
      await page.click('input[id=search-button]');
      await sleep(500)
      await page.click('#results a', {delay: 20})
      await sleep(500)
      const style = await page.evaluate('document.querySelector(".picturefill-background").getAttribute("style")')
      
      const firstSplit = style.split("url('")[1]
      const secondSplit = firstSplit.split("?")[0]

      images.push({
        park: parks[i],
        image: `nps.gov${secondSplit}`,
      })

      file.writeFileSync(`${__dirname}/images.json`, JSON.stringify(images, null, 4))
    } catch (e) {
      console.log(parks[i])
    }
  }
  
  file.writeFileSync(`${__dirname}/images.json`, JSON.stringify(images, null, 4))
  await browser.close();
})();